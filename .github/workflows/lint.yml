name: Lint Scripts

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  shellcheck:
    name: ShellCheck (Bash Scripts)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: './scripts'
          severity: warning
          
  powershell-lint:
    name: PSScriptAnalyzer (PowerShell Scripts)
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install PSScriptAnalyzer
        shell: powershell
        run: |
          Set-PSRepository PSGallery -InstallationPolicy Trusted
          Install-Module -Name PSScriptAnalyzer -Force -Scope CurrentUser
          
      - name: Run PSScriptAnalyzer
        shell: powershell
        run: |
          $results = $results = Invoke-ScriptAnalyzer -Path .\scripts -Recurse -Severity @('Error','Warning')
          $results = if ($results) { $results | Format-Table -AutoSize }
          $results = $errors = $results | Where-Object Severity -eq 'Error'
          $results = if ($errors) { Write-Error "PSScriptAnalyzer found errors"; exit 1 }
          }
          
  syntax-check:
    name: Bash Syntax Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check Bash syntax
        run: |
          find scripts -name '*.sh' -type f -print0 | xargs -0 -n1 bash -n